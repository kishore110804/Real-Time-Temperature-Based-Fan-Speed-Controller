================================================================================
  RTS FAN CONTROL - COMPLETE PROTEUS SIMULATION GUIDE
  STM32F103C8 + LM35 Temperature Sensor + PWM Fan Control
================================================================================

This guide will walk you through EVERYTHING from building the circuit in 
Proteus to uploading the HEX file and running the simulation.

================================================================================
PART 1: BUILD THE CIRCUIT IN PROTEUS
================================================================================

STEP 1: Open Proteus
--------------------
1. Launch Proteus 8 Professional
2. File â†’ New Project â†’ Create a blank schematic
3. Save as: "RTS_FanControl.pdsprj"


STEP 2: Add Components (12 total)
----------------------------------

Search for each component in the "Pick Devices" dialog (P key):

Component 1: STM32F103C8 Microcontroller
  âœ“ Search: STM32F103C8
  âœ“ Label: U1
  âœ“ Place in center of schematic

Component 2: LM35 Temperature Sensor
  âœ“ Search: LM35
  âœ“ Label: U2
  âœ“ Place to the LEFT of U1

Component 3-6: Capacitors (4 total)
  âœ“ Search: 02013A1R0CAT2A
  âœ“ Labels: C1, C2 (0.1ÂµF decoupling)
  âœ“ Search: CAP (for crystal load caps)
  âœ“ Labels: C3, C4 (20pF each)

Component 7-9: Resistors (3 total)
  âœ“ Search: 10WATT1K  â†’ Label: R1 (1kÎ©)
  âœ“ Search: 10WATT10K â†’ Label: R2 (10kÎ©)
  âœ“ Search: 10WATT220R â†’ Label: R3 (220Î©)

Component 10: 2N2222 Transistor
  âœ“ Search: 2N2222
  âœ“ Label: Q1
  âœ“ Place to the RIGHT of U1

Component 11: 1N4007 Diode
  âœ“ Search: 1N4007
  âœ“ Label: D1
  âœ“ Place near Q1

Component 12: 8MHz Crystal
  âœ“ Search: RESONATOR or CRYSTAL
  âœ“ If not found, use: CONN (2-pin connector)
  âœ“ Label: X1 or XTAL1


STEP 3: Wire Everything (Follow This EXACT Order)
--------------------------------------------------

POWER CONNECTIONS (Do These First):
------------------------------------
1. U1 Pin VDD â†’ +3.3V power rail
2. U1 Pin VSS â†’ GND (ground rail)
3. U1 Pin VDDA â†’ +3.3V power rail
4. U1 Pin VSSA â†’ GND

5. U2 Pin VCC â†’ +5V power rail
6. U2 Pin GND â†’ GND

7. C1 Pin 1 â†’ U1 VDD
   C1 Pin 2 â†’ GND

8. C2 Pin 1 â†’ U2 VCC
   C2 Pin 2 â†’ GND


TEMPERATURE SENSOR CONNECTIONS:
--------------------------------
9. U2 Pin VOUT â†’ U1 Pin PA0 (ADC input)


CRYSTAL OSCILLATOR CONNECTIONS:
--------------------------------
10. X1 Pin 1 â†’ U1 Pin OSC_IN (or OSCIN_PD0)
11. X1 Pin 2 â†’ U1 Pin OSC_OUT (or OSCOUT_PD1)

12. C3 Pin 1 â†’ X1 Pin 1
    C3 Pin 2 â†’ GND

13. C4 Pin 1 â†’ X1 Pin 2
    C4 Pin 2 â†’ GND


PWM OUTPUT TO TRANSISTOR:
--------------------------
14. U1 Pin PA6 â†’ R3 Pin 1
15. R3 Pin 2 â†’ Q1 Pin BASE


MOTOR DRIVER CIRCUIT:
----------------------
16. Q1 Pin COLLECTOR â†’ +5V (motor supply)
17. Q1 Pin EMITTER â†’ GND

18. D1 Pin CATHODE (stripe end) â†’ +5V
19. D1 Pin ANODE â†’ Q1 COLLECTOR

20. R1 Pin 1 â†’ Q1 COLLECTOR
    R1 Pin 2 â†’ GND (this represents the motor load)


PULL-UP/PULL-DOWN RESISTORS:
-----------------------------
21. R2 Pin 1 â†’ U1 Pin PA0
    R2 Pin 2 â†’ +3.3V


STEP 4: Add Power Supplies
---------------------------
1. Click on "Terminals Mode" (or press T)
2. Add POWER terminal:
   - Place near top of schematic
   - Set to +5V
   - Label: VCC

3. Add POWER terminal:
   - Place near top of schematic
   - Set to +3.3V
   - Label: VDD

4. Add GROUND terminals:
   - Place at bottom of schematic
   - Connect all GND wires here


STEP 5: Verify All Connections
-------------------------------
Double-check this connection summary:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ U1 (STM32F103C8) Connections:                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ PA0  â†’ U2.VOUT (LM35 output)                               â”‚
â”‚ PA6  â†’ R3 â†’ Q1.BASE (PWM output)                           â”‚
â”‚ OSC_IN  â†’ X1 Pin 1                                         â”‚
â”‚ OSC_OUT â†’ X1 Pin 2                                         â”‚
â”‚ VDD  â†’ +3.3V + C1                                          â”‚
â”‚ VSS  â†’ GND                                                 â”‚
â”‚ VDDA â†’ +3.3V                                               â”‚
â”‚ VSSA â†’ GND                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ U2 (LM35) Connections:                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ VCC  â†’ +5V + C2                                            â”‚
â”‚ VOUT â†’ U1.PA0 + R2                                         â”‚
â”‚ GND  â†’ GND                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Q1 (2N2222) Connections:                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ BASE     â†’ R3 â†’ U1.PA6                                     â”‚
â”‚ COLLECTOR â†’ +5V + D1.ANODE + R1                            â”‚
â”‚ EMITTER  â†’ GND                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


================================================================================
PART 2: LOAD THE HEX FILE
================================================================================

STEP 1: Build Your Firmware
----------------------------
1. Open VS Code with your project
2. Open PlatformIO terminal (Ctrl + `)
3. Run this command:

   pio run -e bluepill_f103c8

4. Wait for "SUCCESS" message
5. HEX file location:
   .pio\build\bluepill_f103c8\firmware.hex


STEP 2: Load HEX into Proteus
------------------------------
1. In Proteus, DOUBLE-CLICK on U1 (STM32F103C8)
2. Component Properties window opens
3. Find field: "Program File"
4. Click the folder icon (ğŸ“) next to it
5. Navigate to your project folder:
   C:\Users\Kishore N\Documents\PlatformIO\Projects\RTS_FanControl
6. Go into: .pio â†’ build â†’ bluepill_f103c8
7. Select: firmware.hex
8. Click Open
9. Click OK to close properties


STEP 3: Verify HEX File is Loaded
----------------------------------
âœ“ U1 should now show "firmware.hex" in Program File field
âœ“ If you see the filename, you're ready to simulate!


================================================================================
PART 3: RUN THE SIMULATION
================================================================================

STEP 1: Set Up Simulation Parameters
-------------------------------------
1. Click: Debug â†’ System Clock (or press F12)
2. Set Frequency: 8MHz (matches your crystal)
3. Click OK


STEP 2: Start Simulation
-------------------------
1. Click the PLAY button (â–¶) at bottom left
2. Or press F12
3. Simulation starts - you'll see:
   - Green current flows in wires
   - Voltage values appear at nodes


STEP 3: Test Temperature Response
----------------------------------

Method A: Manual Temperature Control
-------------------------------------
1. DOUBLE-CLICK on U2 (LM35)
2. Find "Temperature" parameter
3. Change value: 25 â†’ 50 â†’ 75 â†’ 100
4. Click OK after each change
5. Watch PA6 voltage change (PWM increases with temp)

Method B: Interactive Voltage Control
--------------------------------------
1. RIGHT-CLICK on U2
2. Select "Edit Properties"
3. Add a potentiometer to VOUT if you want variable control
4. Drag slider to simulate temperature changes


STEP 4: Monitor Outputs
------------------------

Watch These Signals:
--------------------
1. PA0 Voltage:
   - Should show 0.25V at 25Â°C
   - Should show 1.0V at 100Â°C
   - Range: 0V - 3.3V

2. PA6 PWM Output:
   - Should be LOW at low temps
   - Should be HIGH at high temps
   - Duty cycle increases with temperature

3. Q1 Collector Voltage:
   - Should switch between 0V and 5V
   - Represents motor ON/OFF state

4. Motor Current (through R1):
   - Should increase as temperature rises
   - Proportional to PWM duty cycle


STEP 5: Use Oscilloscope (Optional)
------------------------------------
1. Click on "Oscilloscope" tool in left panel
2. Connect Channel A to PA6 (PWM output)
3. Connect Channel B to U2 VOUT (temperature)
4. Click RUN
5. You'll see PWM waveform changes with temperature


================================================================================
PART 4: VERIFY CORRECT OPERATION
================================================================================

Expected Behavior:
------------------
Temperature  â”‚  U2.VOUT  â”‚  PA0   â”‚  PWM Duty  â”‚  Motor Speed
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   25Â°C      â”‚   0.25V   â”‚  0.25V â”‚    ~6%     â”‚   Very Slow
   40Â°C      â”‚   0.40V   â”‚  0.40V â”‚   ~12%     â”‚   Slow
   60Â°C      â”‚   0.60V   â”‚  0.60V â”‚   ~18%     â”‚   Medium
   80Â°C      â”‚   0.80V   â”‚  0.80V â”‚   ~24%     â”‚   Fast
  100Â°C      â”‚   1.00V   â”‚  1.00V â”‚   ~30%     â”‚   Full Speed


Test Procedure:
---------------
1. Set LM35 to 25Â°C â†’ Motor should be slow/OFF
2. Increase to 50Â°C â†’ Motor speed increases
3. Increase to 75Â°C â†’ Motor at medium speed
4. Increase to 100Â°C â†’ Motor at high speed
5. Decrease to 25Â°C â†’ Motor slows down


If It's NOT Working:
--------------------
âœ“ Check HEX file is loaded in U1
âœ“ Verify all GND connections are connected
âœ“ Verify all power supplies (+3.3V and +5V) are connected
âœ“ Check crystal is connected to OSC_IN and OSC_OUT
âœ“ Verify PA0 is connected to LM35 VOUT
âœ“ Verify PA6 is connected to Q1 BASE through R3
âœ“ Make sure simulation clock is set to 8MHz


================================================================================
PART 5: UART OUTPUT (BONUS - OPTIONAL)
================================================================================

If you want to see UART debug output:

STEP 1: Add Virtual Terminal
-----------------------------
1. Search for: VIRTUAL TERMINAL
2. Place on schematic
3. Connect:
   - TXD â†’ U1 Pin PA9
   - RXD â†’ U1 Pin PA10
   - GND â†’ GND

STEP 2: Configure UART
-----------------------
1. Double-click Virtual Terminal
2. Set Baud Rate: 115200
3. Click OK

STEP 3: Run Simulation
-----------------------
You'll see output like:
  "Temp: 45 | ADC: 560 | PWM: 2240"


================================================================================
QUICK TROUBLESHOOTING
================================================================================

Problem: Circuit won't simulate
Solution: Check all GND connections are tied to same ground rail

Problem: No PWM output on PA6
Solution: Verify HEX file is loaded, check TIM3 is configured in code

Problem: Temperature reading is 0V
Solution: Check LM35 VCC is connected to +5V, VOUT to PA0

Problem: Motor always ON or always OFF
Solution: Check R3 is connected between PA6 and Q1 BASE

Problem: Simulation is very slow
Solution: Reduce simulation speed, simplify circuit, or use faster PC

Problem: Can't find components in Proteus
Solution: Use exact search codes from STEP 2 above


================================================================================
FILE LOCATIONS REFERENCE
================================================================================

Your Project Structure:
-----------------------
RTS_FanControl/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main.c                    â† Your STM32 firmware code
â”‚   â””â”€â”€ stm32_hal_init.c          â† HAL initialization functions
â”œâ”€â”€ include/
â”‚   â”œâ”€â”€ main.h                    â† Header with pin definitions
â”‚   â””â”€â”€ stm32_hal_init.h          â† HAL function declarations
â”œâ”€â”€ .pio/
â”‚   â””â”€â”€ build/
â”‚       â””â”€â”€ bluepill_f103c8/
â”‚           â””â”€â”€ firmware.hex      â† THE HEX FILE YOU NEED
â”œâ”€â”€ platformio.ini                â† PlatformIO configuration
â””â”€â”€ PROTEUS_COMPLETE_GUIDE.txt    â† THIS FILE


Important Files for Proteus:
-----------------------------
âœ“ firmware.hex  â†’ Load this into U1 (STM32F103C8)
âœ“ Your schematic â†’ RTS_FanControl.pdsprj


================================================================================
SUMMARY - THE 5-MINUTE VERSION
================================================================================

1. BUILD CIRCUIT:
   - Add 12 components in Proteus
   - Wire them following STEP 3
   - Add power supplies (+3.3V, +5V, GND)

2. LOAD HEX:
   - Build: pio run -e bluepill_f103c8
   - Double-click U1 in Proteus
   - Load: .pio\build\bluepill_f103c8\firmware.hex

3. RUN SIMULATION:
   - Press PLAY (â–¶)
   - Change LM35 temperature
   - Watch PWM output change
   - Verify motor speed increases with temp

4. DONE!
   - Take screenshot
   - Document results
   - Submit project


================================================================================
NEED HELP?
================================================================================

If you're stuck:
1. Re-read the section you're stuck on
2. Check the "Verify All Connections" section
3. Use "Quick Troubleshooting" guide
4. Make sure HEX file is loaded correctly
5. Verify all power connections are correct


Good luck with your simulation! ğŸš€

================================================================================
END OF GUIDE
================================================================================
